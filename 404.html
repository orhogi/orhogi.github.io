<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>cote.my — Instant Redirect</title>
  
  <meta http-equiv="refresh" content="0; url=about:blank" id="meta-redirect-tag">
  
  <style>
    /* Minimalist CSS - The goal is that this page is never visible */
    :root{--bg:#fff;--fg:#111;--muted:#666}
    html,body{height:100%}
    body{margin:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#f8fafc,#fff);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--fg)}
    .card{max-width:720px;padding:28px;border-radius:12px;box-shadow:0 6px 24px rgba(16,24,40,.08);background:rgba(255,255,255,.9);text-align:center}
    h1{margin:0 0 8px;font-size:18px}
    p{margin:0 0 14px;color:var(--muted)}
    .link{word-break:break-all;background:#f3f4f6;padding:10px;border-radius:8px;margin:12px 0}
    a.button{display:inline-block;padding:10px 16px;border-radius:9px;background:#0b69ff;color:#fff;text-decoration:none}
    small{display:block;margin-top:10px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1 id="title">Redirecting…</h1>
    <p id="desc">Preparing clean Instagram link for you. Please wait.</p>

    <div id="linkbox" class="link" style="display:none"></div>
    <a id="manual" class="button" href="#" style="display:none">Go to destination</a>
    <small id="note">If you are not redirected automatically, click the button above.</small>
  </div>

<script>
(function(){
  // --- Element References ---
  const titleEl = document.getElementById('title');
  const descEl = document.getElementById('desc');
  const noteEl = document.getElementById('note');
  const linkboxEl = document.getElementById('linkbox');
  const manualEl = document.getElementById('manual');
  const metaRedirectTag = document.getElementById('meta-redirect-tag');

  // --- Path Normalization and Cleaning ---
  // Get the path, excluding the query string (which contains tracking codes)
  const rawPath = window.location.pathname; 
  
  // Normalize path: removes multiple slashes and leading/trailing slashes.
  const path = rawPath
    .replace(/\/+/g, '/') 
    .replace(/^\/|\/$/g, ''); 

  // --- 1. Handle Root/Info Page ---
  if (!path || path === '') {
    // If no path is present (i.e., at the root URL), show the info page
    titleEl.innerText = 'cote.my — Instagram Link Shortener';
    descEl.innerText = 'Usage examples: /reel/<id>/ , /p/<id>/ , /user/<username>/';
    noteEl.innerText = 'This file must be configured as the catch-all/404 page for the redirect to function.';
    // Remove the meta refresh for the info page
    metaRedirectTag.remove(); 
    return;
  }

  // --- 2. Build CLEAN Target URL ---
  // We explicitly IGNORE window.location.search, stripping all tracking codes.
  // Target format: https://www.instagram.com/[normalized_path]/
  const target = `https://www.instagram.com/${path}/`;

  // --- 3. Set Meta Refresh for Instant Redirect (Non-JS fallback) ---
  // This is the fastest method and runs immediately upon parsing the <head> tag.
  metaRedirectTag.setAttribute('content', `0; url=${target}`);

  // --- 4. Update UI for Manual Fallback ---
  linkboxEl.style.display = 'block';
  linkboxEl.textContent = target;
  manualEl.href = target;
  manualEl.style.display = 'inline-block';

  // --- 5. Perform Automatic JS Redirect (Clean History) ---
  // Use a 0ms timeout to ensure this runs AS SOON AS POSSIBLE,
  // overriding the meta tag and using replace() to keep history clean.
  setTimeout(() => {
    try {
      window.location.replace(target);
    } catch (e) {
      // Fallback: Ensure the manual button is visible if the automatic redirect fails.
      manualEl.style.display = 'inline-block';
    }
  }, 0); 
})();
</script>
</body>
</html>
