<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redirecting to Instagram...</title>
  
  <meta http-equiv="refresh" content="0; url=about:blank" id="meta-redirect-tag">

  <meta property="og:title" content="Loading Instagram link..." id="og-title">
  <meta property="og:description" content="Click here to view the content on Instagram." id="og-description">
  <meta property="og:url" content="" id="og-url">
  <meta property="og:image" content="https://www.instagram.com/static/images/ico/favicon-192.png/68d99ba29cc8.png">
  <meta property="og:type" content="website">

  
  <style>
    /* NEW: Make the body invisible to hide the "Redirecting..." content 
      while the redirect executes.
    */
    body {
        margin:0;
        display:flex;
        align-items:center;
        justify-content:center;
        background:linear-gradient(180deg,#f8fafc,#fff);
        font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
        color:var(--fg);
        height: 100%;
        visibility: hidden; /* Hides content during immediate redirect */
    }

    /* Keep card visible for the root info page/manual fallback if needed */
    .card {
        visibility: visible;
        max-width:720px;padding:28px;border-radius:12px;box-shadow:0 6px 24px rgba(16,24,40,.08);background:rgba(255,255,255,.9);text-align:center
    }

    /* Existing styles */
    :root{--bg:#fff;--fg:#111;--muted:#666}
    html,body{height:100%}
    h1{margin:0 0 8px;font-size:18px}
    p{margin:0 0 14px;color:var(--muted)}
    .link{word-break:break-all;background:#f3f4f6;padding:10px;border-radius:8px;margin:12px 0}
    a.button{display:inline-block;padding:10px 16px;border-radius:9px;background:#0b69ff;color:#fff;text-decoration:none}
    small{display:block;margin-top:10px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1 id="title">Redirecting…</h1>
    <p id="desc">Preparing clean Instagram link for you. Please wait.</p>

    <div id="linkbox" class="link" style="display:none"></div>
    <a id="manual" class="button" href="#" style="display:none">Go to destination</a>
    <small id="note">If you are not redirected automatically, click the button above.</small>
  </div>

<script>
(function(){
  // --- Element References ---
  const titleEl = document.getElementById('title');
  const descEl = document.getElementById('desc');
  const noteEl = document.getElementById('note');
  const linkboxEl = document.getElementById('linkbox');
  const manualEl = document.getElementById('manual');
  const metaRedirectTag = document.getElementById('meta-redirect-tag');
  
  // Open Graph tags
  const ogTitleEl = document.getElementById('og-title');
  const ogDescEl = document.getElementById('og-description');
  const ogUrlEl = document.getElementById('og-url');


  // --- Path Normalization and Cleaning ---
  const rawPath = window.location.pathname; 
  
  const path = rawPath
    .replace(/\/+/g, '/') 
    .replace(/^\/|\/$/g, ''); 

  // --- 1. Handle Root/Info Page ---
  if (!path || path === '') {
    titleEl.innerText = 'cote.my — Instagram Link Shortener';
    descEl.innerText = 'Usage examples: /reel/<id>/ , /p/<id>/ , /user/<username>/';
    noteEl.innerText = 'This file must be configured as the catch-all/404 page for the redirect to function.';
    
    // Remove redirect mechanisms and keep card visible
    metaRedirectTag.remove(); 
    document.body.style.visibility = 'visible';
    return;
  }

  // --- 2. Build CLEAN Target URL ---
  // Strips all tracking codes like ?utm_source...
  const target = `https://www.instagram.com/${path}/`;

  // --- 3. Dynamic Embed/Preview Update (For Social Apps) ---
  ogTitleEl.setAttribute('content', 'Instagram Content from ' + (path.split('/')[0] === 'stories' ? 'Story' : path.split('/')[0]).toUpperCase());
  ogDescEl.setAttribute('content', 'View the content directly on Instagram. Tap to view.');
  ogUrlEl.setAttribute('content', target);


  // --- 4. Set Meta Refresh for Instant Redirect (Non-JS fallback) ---
  metaRedirectTag.setAttribute('content', `0; url=${target}`);

  // --- 5. Update UI for Manual Fallback ---
  linkboxEl.style.display = 'block';
  linkboxEl.textContent = target;
  manualEl.href = target;
  manualEl.style.display = 'inline-block';

  // --- 6. Perform Automatic JS Redirect (Clean History) ---
  // 0ms timeout ensures this runs AS SOON AS POSSIBLE
  setTimeout(() => {
    try {
      window.location.replace(target);
    } catch (e) {
      manualEl.style.display = 'inline-block';
      // If JS redirect fails, make the content visible for manual click
      document.body.style.visibility = 'visible'; 
    }
  }, 0); 
})();
</script>
</body>
</html>
